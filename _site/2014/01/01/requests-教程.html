<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="/stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="/stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="/stylesheets/print.css" media="print" />
    <link rel="stylesheet" type="text/css" href="/stylesheets/tomorrow-night.css" media="screen" />
    <script src="/javascripts/highlight.pack.js"></script>
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>Requests 教程 HTTP for Humans</title>
    <script>
        hljs.tabReplace = '';
        hljs.initHighlightingOnLoad();
    </script>

  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>Yiner in Python</h1>
        </header>


        <hr>

        <section id="main_content">
            <h1 id="">创建一个请求</h1>

<p>创建一个请求非常简单</p>

<p>首先导入需要的模块</p>

<pre><code>&gt;&gt;&gt; import requests</code></pre>

<p>现在，我们尝试打开一个页面。在这里我们打开GitHub的公共时间表</p>

<pre><code>&gt;&gt;&gt; r = requests.get('https://github.com/timeline.json')</code></pre>

<p>然后我们得到一个一个名为r的响应对象,我们可以从这个对象中获取所有我们想要的东西。</p>

<p>HTTP的其他请求也可以</p>

<pre><code>&gt;&gt;&gt; r = requests.post(&quot;http://httpbin.org/post&quot;)
&gt;&gt;&gt; r = requests.put(&quot;http://httpbin.org/put&quot;)
&gt;&gt;&gt; r = requests.delete(&quot;http://httpbin.org/delete&quot;)
&gt;&gt;&gt; r = requests.head(&quot;http://httpbin.org/get&quot;)
&gt;&gt;&gt; r = requests.options(&quot;http://httpbin.org/get&quot;)</code></pre>

<p>这些做的很好了，但是这对Requests来说仅仅是个开始</p>

<h1 id="url">将参数添加到URL</h1>

<p>我们经常希望在URL中添加一些查询字符串，如果我们手动构建的话，我们需要以键值对将参数放到问号后面添加到URL中 httpbin.org/get?key=val</p>

<p>Requests允许我们将这些参数放到一个字典里，通过params参数将之加入到URL中，eg.如果我们想将key1=value1和key2=value2加入到httpbin.org/get中</p>

<pre><code>&gt;&gt;&gt; payload = {'key1': 'value1', 'key2': 'value2'}
&gt;&gt;&gt; r = requests.get(&quot;http://httpbin.org/get&quot;, params=payload)

&gt;&gt;&gt; print r.url
u'http://httpbin.org/get?key2=value2&amp;key1=value1'</code></pre>

<h1 id="string">响应String格式的内容</h1>

<pre><code>&gt;&gt;&gt; import requests
&gt;&gt;&gt; r = requests.get('https://github.com/timeline.json')
&gt;&gt;&gt; r.text
'[{&quot;repository&quot;:{&quot;open_issues&quot;:0,&quot;url&quot;:&quot;https://github.com/...</code></pre>

<h1 id="_2">编码</h1>

<p>Requests会自动的解码,Requsts会从HTTP 的 headers中获取编码,然后在你使用r.text的时候进行编码,还可以更改编码方式</p>

<pre><code>&gt;&gt;&gt; r.encoding
'utf-8'
&gt;&gt;&gt; r.encoding = 'ISO-8859-1'</code></pre>

<p>如果你更改了编码方式,Requests会在你以后使用r.text的时候使用新的编码方式</p>

<p>Requests 会在你需要的时候使用你自己定义的编码.如果你已经创建了你自己的编码方 式,并在codes模块中注册了他们,你可以</p>

<p>将他们的名字坐在r.encoding的值,Requests将会为你处理编码</p>

<h1 id="_3">以二进制的方式响应内容</h1>

<p>对于非文本文件,你可以以二进制的方式查看响应的内容:</p>

<pre><code>&gt;&gt;&gt; r.content
b'[{&quot;repository&quot;:{&quot;open_issues&quot;:0,&quot;url&quot;:&quot;https://github.com/...</code></pre>

<p>如果你请求了一个二进制数据,并想把它存为一个图片:</p>

<pre><code>&gt;&gt;&gt; from PIL import Image
&gt;&gt;&gt; from StringIO import StringIO
&gt;&gt;&gt; i = Image.open(StringIO(r.content))</code></pre>

<h1 id="json">响应JSON格式的数据</h1>

<p>Requests内置了一个JSON的解码器用来处理JSON格式的数据</p>

<pre><code>&gt;&gt;&gt; r.content
b'[{&quot;repository&quot;:{&quot;open_issues&quot;:0,&quot;url&quot;:&quot;https://github.com/...</code></pre>

<p>gzip和deflate会自动的为你解码 如果解码JSON格式的数据失败,那么r.json会返回None</p>

<h1 id="_4">响应未经处理的内容</h1>

<p>在很少的情况下,你将从服务器活的未经处理的socket内容,你可以使用r.raw</p>

<pre><code>&gt;&gt;&gt; r.raw
&lt;requests.packages.urllib3.response.HTTPResponse object at 0x101194810&gt;

&gt;&gt;&gt; r.raw.read(10)
'\x1f\x8b\x08\x00\x00\x00\x00\x00\x00\x03'</code></pre>

<h1 id="http_headers">自定义HTTP headers</h1>

<p>如果你需要在请求中加入HTTP headers,仅仅传递一个字典作为参数就可以</p>

<pre><code>&gt;&gt;&gt; import json
&gt;&gt;&gt; url = 'https://api.github.com/some/endpoint'
&gt;&gt;&gt; payload = {'some': 'data'}
&gt;&gt;&gt; headers = {'content-type': 'application/json'}

&gt;&gt;&gt; r = requests.post(url, data=json.dumps(payload), headers=headers)</code></pre>

<h1 id="post">更复杂的POST请求(提交表单)</h1>

<pre><code>&gt;&gt;&gt; payload = {'key1': 'value1', 'key2': 'value2'}
&gt;&gt;&gt; r = requests.post(&quot;http://httpbin.org/post&quot;, data=payload)
&gt;&gt;&gt; print r.text
{
  // ...snip... //
  &quot;form&quot;: {
    &quot;key2&quot;: &quot;value2&quot;,
    &quot;key1&quot;: &quot;value1&quot;
  },
  // ...snip... //
}</code></pre>
        </section>

        <footer>
          This page was generated by <a href="http://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.
        </footer>

        
      </div>
    </div>
  </body>
</html>
