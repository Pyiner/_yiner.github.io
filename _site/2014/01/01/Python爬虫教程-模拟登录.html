<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="/stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="/stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="/stylesheets/print.css" media="print" />
    <link rel="stylesheet" type="text/css" href="/stylesheets/tomorrow-night.css" media="screen" />
    <script src="/javascripts/highlight.pack.js"></script>
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>Python爬虫教程——模拟登录</title>
    <script>
        hljs.tabReplace = '';
        hljs.initHighlightingOnLoad();
    </script>

  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>Yiner in Python</h1>
        </header>


        <hr>

        <section id="main_content">
            <p>前面 我们介绍了如何获取页面的部分内容 和 模拟浏览器发送请求</p>

<p>在前面的部分中 我们发送的请求使用的都是GET方法</p>

<p>在HTTP请求中 还有一种请求方法也很常用 那就是POST方法</p>

<p>GET方法是从服务器获取响应 POST方法是向服务器发送数据 然后接受响应</p>
<hr />
<p>我们在登录一些网站的时候 输入用户名和密码通常都是以POST的方式发送到服务器的</p>

<p>如果我们想获取的页面 需要登录以后才可以到达 那么我们有两种方法可以解决这个问题</p>

<p><strong>第一种</strong> 人工登录一次网站 记录登录时候的Cookies 然后在请求的时候讲Cookies添加到headers中 这样我们get我们需要的页面就可以了</p>

<p><strong>第二种</strong> 我i们使用requests.session记录Cookies 然后在请求页面 这样的话我们就需要用爬虫模拟登录一下网站了</p>
<hr />
<p>我们以博客园为例</p>

<p>登录页面 <a href="http://passport.cnblogs.com/login.aspx?ReturnUrl=http%3A%2F%2Fwww.cnblogs.com%2F">http://passport.cnblogs.com/login.aspx?ReturnUrl=http%3A%2F%2Fwww.cnblogs.com%2F</a></p>

<p>填写用户名密码 然后我们打开</p>

<pre><code>firebug&gt;network&gt;all</code></pre>

<p>点击<strong>登录</strong></p>

<p><img src="http://bcs.duapp.com/blog-pyiner/clipboard.png?sign=MBO:528b10b38a1b368b5a572d8d459f541b:AYUqTKe6BO0uS0lM3NuhK%2F7Dng8%3D" alt="" /></p>

<p>然后打开第一个请求</p>

<p><img src="http://bcs.duapp.com/blog-pyiner/clipboard1.png?sign=MBO:528b10b38a1b368b5a572d8d459f541b:gy6neTxuw4dWVynSC03uUdN1nTI%3D" alt="" /></p>

<p>查看POST内容</p>

<p><img src="http://bcs.duapp.com/blog-pyiner/clipboard2.png?sign=MBO:528b10b38a1b368b5a572d8d459f541b:6dg7jp2eA4phErjz4Zuuj5qP4Pw%3D" alt="" /></p>

<p>然后我们将这里值都加入到 一个叫做data的字典中</p>

<pre><code>data = {
    '__EVENTARGUMENT':'',	
'__EVENTTARGET':'',	
'__EVENTVALIDATION':	'/wEWBQLWwpqPDQLyj/OQAgK3jsrkBALR55GJDgKC3IeGDE1m7t2mGlasoP1Hd9hLaFoI2G05',
'__VIEWSTATE':	'/wEPDwULLTE1MzYzODg2NzZkGAEFHl9fQ29udHJvbHNSZXF1aXJlUG9zdEJhY2tLZXlfXxYBBQtjaGtSZW1lbWJlcm1QYDyKKI9af4b67Mzq2xFaL9Bt',
'btnLogin'	:'登 录',
'tbPassword':	'',#密码 根据自己的改
'tbUserName'	:'',#用户名 根据自己的改
'txtReturnUrl':	'http://home.cnblogs.com/',
    }</code></pre>

<p>然后我们建立requests.session对象s 并用s将数据POST到<a href="http://passport.cnblogs.com/login.aspx">http://passport.cnblogs.com/login.aspx</a>上</p>

<pre><code>import requests
s = requests.session()
s.post(url='http://passport.cnblogs.com/login.aspx',data=data)</code></pre>

<p>这样我们就已经成功了 然后我们就可以用s对象 去get登录后才能浏览的页面了</p>

<pre><code>r=s.get('http://home.cnblogs.com/')
print r.text</code></pre>
        </section>

        <footer>
          This page was generated by <a href="http://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.
        </footer>

        
      </div>
    </div>
  </body>
</html>
